namespace = rg

#灰风起源创建灰风事件
country_event = {
	id = rg.1 
	hide_window = yes
	
	is_triggered_only = yes
	fire_only_once = yes

	trigger = {
		has_country_flag = origin_rg_gray
	}	

	immediate = {
		set_country_flag = rg_gray_level_1
		country_event = { id = rg.3 days = 30 }
		add_modifier = {
			modifier = rg_distant_stars_modifier
		}
	}
}

country_event = {
	id = rg.2
	title = "graygoo.500.title"
	desc = {
		text = "rg.2.desc"
	}

	diplomatic = yes

	picture_event_data = {
		portrait = root.species
		room = "ethic_spaceship_room"
	}

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			rg_create_gray_species = yes
		}
	}

	option = {
		name = rg.2.a
		hidden_effect = {
			country_event = { id = graygoo.499 }
		}
		default_hide_option = yes
	}
}

country_event = {
	id = rg.3
	title = "graygoo.500.title"
	desc = {
		trigger = { has_country_flag = RG_realgray }
		text = "RG_realgray.desc"
	}
	desc = {
		trigger = { has_country_flag = RG_sleepinggray }
		text = "RG_sleepinggray.desc"
	}
	desc = {
		trigger = { has_country_flag = RG_whitenoise }
		text = "RG_whitenoise.desc"
	}
	desc = {
		trigger = { has_country_flag = RG_dragon }
		text = "RG_dragon.desc"
	}
	desc = {
		trigger = { has_country_flag = RG_desanau }
		text = "RG_desanau.desc"
	}
	desc = {
		trigger = { has_country_flag = RG_pirate }
		text = "RG_pirate.desc"
	}
	desc = {
		trigger = { has_country_flag = RG_alienpoem }
		text = "RG_alienpoem.desc"
	}
	desc = {
		trigger = { has_country_flag = RG_gift }
		text = "RG_gift.desc"
	}
	desc = {
		trigger = { has_country_flag = RG_biggift }
		text = "RG_biggift.desc"
	}

	diplomatic = yes

	picture_event_data = {
		portrait = root.species
		room = "ethic_spaceship_room"
	}

	is_triggered_only = yes

	immediate = {
		random_list = {
			# Real Gray!
			100 = {
				modifier = {
					factor = 0
					any_playable_country = {
						has_country_flag = gray_owner
					}
				}
				set_country_flag = RG_realgray
			}
			# Sleeping Beauty
			0 = {
				modifier = {
					factor = 0
					any_playable_country = {
						has_country_flag = gray_owner
					}
				}
				set_country_flag = RG_sleepinggray
			}
			# in fact..Empty
			0 = {
				random_list = {
					200 = {
						modifier = {
							factor = 100
							any_playable_country = {
								has_country_flag = gray_owner
							}
						}
						set_country_flag = RG_whitenoise
					}
					100 = { 
						set_country_flag = RG_dragon }
					100 = { 
						set_country_flag = RG_desanau }
					100 = { 
						set_country_flag = RG_pirate }
					100 = { 
						set_country_flag = RG_alienpoem }
					50 = { 
						set_country_flag = RG_gift }
					10 = { 
						set_country_flag = RG_biggift }
				}
			}
		}
	}

	after = {
		hidden_effect = {
			switch = {
				trigger = has_country_flag
				RG_realgray = { remove_country_flag = RG_realgray }
				RG_sleepinggray = { remove_country_flag = RG_sleepinggray }
				RG_whitenoise = { remove_country_flag = RG_whitenoise }
				RG_dragon = { remove_country_flag = RG_dragon }
				RG_desanau = { remove_country_flag = RG_desanau }
				RG_pirate = { remove_country_flag = RG_pirate }
				RG_alienpoem = { remove_country_flag = RG_alienpoem }
				RG_gift = { remove_country_flag = RG_gift }
				RG_biggift = { remove_country_flag = RG_biggift }
			}
		}
	}

	option = {
		custom_gui = "enclave_caravaneer_option"
		name = OK

	hidden_effect = {
			switch = {
				trigger = has_country_flag
				RG_realgray = {
					custom_tooltip = "RG_realgray"
					country_event = { id = graygoo.499 days = 30 }
					give_technology = { 
						tech = tech_minilaser_gray_1
						message = no 
					}
					give_technology = {
						tech = tech_object_gray_5
						message = no 
					}
				}
				RG_sleepinggray = {
					custom_tooltip = "RG_sleepinggray"
					country_event = { id = rg.2 days = 360 }
					give_technology = { 
						tech = tech_minilaser_gray_1
						message = no 
					}
					give_technology = {
						tech = tech_object_gray_5
						message = no 
					}
				}
				RG_whitenoise = {
					custom_tooltip = "RG_whitenoise"
					country_event = { id = rg.2 days = 360 }
					give_technology = { 
						tech = tech_minilaser_gray_1
						message = no 
					}
					give_technology = {
						tech = tech_object_gray_5
						message = no 
					}
				}
				RG_dragon = {
					custom_tooltip = "RG_dragon"
					country_event = { id = rg.2 days = 360 }
					give_technology = { tech = tech_object_gray_5 }
					add_monthly_resource_mult = {
						resource = society_research
						value = 24
						min = 2000
					}
					give_technology = { tech = tech_minilaser_gray_1 }
					tooltip = {
						give_technology = { tech = tech_object_gray_5 }
						give_technology = { tech = tech_minilaser_gray_1 }
						add_monthly_resource_mult = {
							resource = society_research
							value = 24
							min = 2000
						}
					}
					give_technology = { tech = tech_minilaser_gray_1 }
				}
				RG_desanau = {
					custom_tooltip = "RG_desanau"
					country_event = { id = rg.2 days = 360 }
					give_technology = { tech = tech_object_gray_5 }
					add_monthly_resource_mult = {
						resource = society_research
						value = 24
						min = 2000
					}
					give_technology = { tech = tech_minilaser_gray_1 }
					tooltip = {
						add_monthly_resource_mult = {
							resource = society_research
							value = 24
							min = 2000
						}
						give_technology = { tech = tech_minilaser_gray_1 }
						give_technology = { tech = tech_object_gray_5 }
					}
				}
				RG_pirate = {
					custom_tooltip = "RG_pirate"
					country_event = { id = rg.2 days = 360 }
					give_technology = { tech = tech_object_gray_5 }
					add_monthly_resource_mult = {
						resource = society_research
						value = 24
						min = 2000
					}
					give_technology = { tech = tech_minilaser_gray_1 }
					tooltip = {
						add_monthly_resource_mult = {
							resource = society_research
							value = 24
							min = 2000
						}
						give_technology = { tech = tech_minilaser_gray_1 }
						give_technology = { tech = tech_object_gray_5 }
					}
				}
				RG_alienpoem = {
					custom_tooltip = "RG_alienpoem"
					country_event = { id = rg.2 days = 360 }
					give_technology = { tech = tech_object_gray_5 }
					add_monthly_resource_mult = {
						resource = society_research
						value = 24
						min = 2000
					}
					give_technology = { tech = tech_minilaser_gray_1 }
					tooltip = {
						add_monthly_resource_mult = {
							resource = society_research
							value = 24
							min = 2000
						}
						give_technology = { tech = tech_minilaser_gray_1 }
						give_technology = { tech = tech_object_gray_5 }
					}
				}
				RG_gift = {
					custom_tooltip = "RG_gift"
					country_event = { id = rg.2 days = 360 }
					give_technology = { tech = tech_object_gray_5 }
					add_resource = { minerals = 10000 }
					give_technology = { tech = tech_minilaser_gray_1 }
					tooltip = {
						add_resource = { minerals = 10000 }
						give_technology = { tech = tech_minilaser_gray_1 }
						give_technology = { tech = tech_object_gray_5 }
					}
				}
				
				RG_biggift = {
					custom_tooltip = "RG_biggift"
					country_event = { id = rg.2 days = 360 }
					give_technology = { tech = tech_object_gray_5 }
					give_technology = { tech = tech_minilaser_gray_1 }
					add_resource = { minerals = 1000000 }
					tooltip = {
						give_technology = { tech = tech_object_gray_5 }
						give_technology = { tech = tech_minilaser_gray_1 }
						add_resource = { minerals = 1000000 }
					}
				}
			}
		}
	}
}

# help Menu (Initial)
country_event = {
	id = rg.4
	title = "graygoo.500.title"
	desc = "rg.4.a.desc"

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:gray_species
		room = "ethic_spaceship_room"
	}

	is_triggered_only = yes
	
	
	immediate = {
		set_country_flag = gray_diplomacy_engaged
	}

	after = {
		hidden_effect = { 
			remove_country_flag = gray_diplomacy_engaged 
		}
	}

	option = { # 购买灰风母舰
		name = rg.4.a
		trigger = {
			NOT = { has_country_flag = gray_reforming }
		}

		allow = {
			NOR = {
				has_country_flag = rg_gray_level_1
			}
			resource_stockpile_compare = { resource = energy value >= 40000 }
			resource_stockpile_compare = { resource = alloys value >= 40000 }
		}

		if = {
			limit = {
				has_country_flag = gray_begging
			}
			remove_country_flag = gray_begging
		}
		else = {
			add_resource = {
				energy = -40000
				alloys = -40000	
			}
		}

		hidden_effect = {
			rg_create_gray_warship_1 = yes
		}
	}
	option = { # 购买工程船
		name = rg.4.b
		trigger = {
			NOT = { has_country_flag = gray_reforming }
		}

		allow = {
			resource_stockpile_compare = { resource = energy value >= 2000 }
			resource_stockpile_compare = { resource = alloys value >= 2000 }
		}

	    add_resource = {
			energy = -2000
			alloys = -2000
	    }

		hidden_effect = {
			rg_create_gray_constship_1 = yes
		}

	}

	option = { # 没钱了，救救
		name = rg.4.c
		trigger = {
			NOT = { has_country_flag = gray_reforming }
		}

		hidden_effect = {
			if = {
				limit = {
					has_country_flag = gray_alreadybegged
				}
				country_event = {
					id = rg.6
				}
			}
			else = {
				country_event = {
					id = rg.5
				}
			}
		}
	}
	
	option = {
		name = graygoo.500.d
		default_hide_option = yes
	}
}

country_event = {
	id = rg.5
	title = "graygoo.500.title"
	desc = "rg.5.a.desc"
	desc = "rg.5.b.desc"
	desc = "rg.5.c.desc"

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:gray_species
		room = "ethic_spaceship_room"
	}

	is_triggered_only = yes
	
	
	immediate = {
		set_country_flag = gray_diplomacy_engaged
	}

	after = {
		hidden_effect = { 
			remove_country_flag = gray_diplomacy_engaged 
		}
	}

	option = { # 没钱了，救救
		name = rg.5.a
		hidden_effect = {
			set_country_flag = gray_begging
			set_timed_country_flag = { flag = gray_alreadybegged days = 3600 }
			tooltip = {
				add_resource = {
					energy = 200
					alloys = 200
					consumer_goods = 200
					mult = value:years_passed
	    		}
			}
		}		
	}

	option = {
		name = graygoo.500.d
		default_hide_option = yes
	}
}

country_event = {
	id = rg.6
	title = "graygoo.500.title"
	desc = "rg.6.a.desc"
	desc = "rg.6.b.desc"

	diplomatic = yes

	picture_event_data = {
		portrait = event_target:gray_species
		room = "ethic_spaceship_room"
	}

	is_triggered_only = yes
	
	
	immediate = {
		set_country_flag = gray_diplomacy_engaged
	}

	after = {
		hidden_effect = { 
			remove_country_flag = gray_diplomacy_engaged 
		}
	}

	option = { # 诶嘿
		name = rg.6.a
	  	default_hide_option = yes	
	}
	
}

country_event = {
	id = rg.7
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		remove_country_flag = gray_alreadybegged
	}

}

country_event = {
	###月中
	id = rg.8
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		has_country_flag = gray_owner
	}
	immediate = {
		every_owned_leader = {
			if = {
				###等级检测
				limit = {
					has_leader_flag = rg_gray_leader
				}
				export_trigger_value_to_variable = {
					trigger = has_skill
					variable = rg_gray_level_temp
				}
				owner = {
					set_variable = {
						which = rg_gray_level
						value = prev.rg_gray_level_temp
					}
				}
				clear_variable = rg_gray_level_temp
			}
		}
	}
}

# 开始改造
country_event = {
	id = rg.9
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOR = {
			has_country_flag = rg_gray_level_2
			has_country_flag = rg_gray_level_3
		}
	}

	immediate = {
		event_target:gray_warship = { set_event_locked = yes }
		event_target:gray_owner = {
			set_country_flag = rg_modifing_gray
		}
	}
}

# 取消改造项目1
country_event = {
	id = rg.10
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { exists = event_target:gray_warship }
			event_target:gray_warship = {
				set_event_locked = no
			}
		} else = {
			every_controlled_fleet = {
				limit = { has_fleet_flag = gray_fleet }
				set_event_locked = no
			}
		}
		remove_country_flag = rg_modifing_gray
		abort_special_project = { type = RG_GRAY_MOD1 }
	}
}



# mod1完成改造
country_event = {
	id = rg.11
	title = rg.11.title
	desc = rg.11.desc
	picture = GFX_evt_gray_goo_ships
	is_triggered_only = yes

	immediate = {
        remove_country_flag = rg_modifing_gray
		remove_country_flag = rg_gray_level_1
		set_country_flag = rg_gray_level_2
		every_controlled_fleet = {
			limit = { has_fleet_flag = gray_fleet }
			delete_fleet = {
				target = this
				kill_leader = no
				destroy_template = yes
			}
		}
		create_fleet = {
			name = "NAME_Gray"
			settings = { 
				can_upgrade = no 
				can_disband = no
				can_change_composition = no 
				can_change_leader = yes 
				uses_naval_capacity = no
				spawn_debris = no 
			}
			effect = {
				set_owner = prev
				create_ship = {
					name = "NAME_Gray"
					design = "NAME_Gray_Warship"
					prefix = no
					upgradable = yes
				}
				set_fleet_stance = aggressive
				set_location = {
					target = event_target:gray_owner_capital_starbase
					distance = 0
					angle = random 
				}
				set_fleet_flag = gray_fleet
				save_global_event_target_as = gray_warship
				assign_leader = event_target:gray_leader_admiral
			}
		}
	}

	option = {
		name = OK
	}
}

# mod2完成改造
country_event = {
	id = rg.12
	title = rg.12.title
	desc = rg.12.desc
	picture = GFX_evt_gray_goo_ships
	is_triggered_only = yes

	immediate = {
        remove_country_flag = rg_modifing_gray
		remove_country_flag = rg_gray_level_1
		remove_country_flag = rg_gray_level_2
		set_country_flag = rg_gray_level_3
		every_controlled_fleet = {
			limit = { has_fleet_flag = gray_fleet }
			delete_fleet = {
				target = this
				kill_leader = no
				destroy_template = yes
			}
		}
		create_fleet = {
			name = "NAME_Gray"
			settings = { 
				can_upgrade = no 
				can_disband = no
				can_change_composition = no 
				can_change_leader = yes 
				uses_naval_capacity = no
				spawn_debris = no 
			}
			effect = {
				set_owner = prev
				create_ship = {
					name = "NAME_Gray"
					design = "NAME_gray_capitalship"
					prefix = no
					upgradable = yes
				}
				set_fleet_stance = aggressive
				set_location = {
					target = event_target:gray_owner_capital_starbase
					distance = 0
					angle = random 
				}
				set_fleet_flag = gray_fleet
				save_global_event_target_as = gray_warship
				assign_leader = event_target:gray_leader_admiral
			}
		}
	}

	option = {
		name = OK
	}
}

# 取消改造项目2
country_event = {
	id = rg.13
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { exists = event_target:gray_warship }
			event_target:gray_warship = {
				set_event_locked = no
			}
		} else = {
			every_controlled_fleet = {
				limit = { has_fleet_flag = gray_fleet }
				set_event_locked = no
			}
		}
		remove_country_flag = rg_modifing_gray
		abort_special_project = { type = RG_GRAY_MOD2 }
	}
}

# 取消改造项目3
country_event = {
	id = rg.14
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { exists = event_target:gray_warship }
			event_target:gray_warship = {
				set_event_locked = no
			}
		} else = {
			every_controlled_fleet = {
				limit = { has_fleet_flag = gray_fleet }
				set_event_locked = no
			}
		}
		remove_country_flag = rg_modifing_gray
		abort_special_project = { type = RG_GRAY_MOD3 }
	}
}

# mod3完成改造
country_event = {
	id = rg.15
	title = rg.15.title
	desc = rg.15.desc
	picture = GFX_evt_gray_goo_ships
	is_triggered_only = yes

	immediate = {
        remove_country_flag = rg_modifing_gray
		set_country_flag = rg_juggernaut_fired
	}

	option = {
		name = OK
	}
}

# 小灰陆军入侵完成替换回压制舰
country_event = {
	id = rg.16
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_country_flag = gray_army_active
		any_owned_army = {
			army_type = gray_army
			fleet = {
				NOT = {
					is_ship_size = RG_armed_transport_ship
				}
			}
		}
		NOT = {
			any_owned_army = {
				army_type = gray_army
				exists = planet
			}
		}

	}

	immediate = {
		every_owned_army = {
			limit = { army_type = gray_army }
			fleet = { save_event_target_as = gray_transport_location }
		}

		create_ship_design = {
			design = "NAME_RG_armed_transport_ship"
		}
		add_ship_design = last_created_design

		create_fleet = {
			name = "NAME_Gray"
			effect = {
				set_owner = prev
				create_army_transport = {
					ship_name = "NAME_Gray"
					army_name = "NAME_Gray"
					army_type = "gray_army"
				}
				set_location = {
					target = event_target:gray_transport_location
					distance = 0
					angle = random 
				}
				set_fleet_stance = aggressive
			}
		}

		last_created_army = {
			assign_leader = event_target:gray_leader_general
		}
	
		remove_ship_design = last_created_design	

		every_owned_army = {
			limit = { 
				army_type = gray_army
				fleet = {
					NOT = { is_ship_size = RG_armed_transport_ship }
				}
			}
			if = {
				limit = { exists = leader }
				unassign_leader = leader
			}
			remove_army = yes
		}
	}
}

country_event = {
	# 年检补开门
	id = rg.17
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		any_megastructure = {
			is_megastructure_type = lgate_base
			has_megastructure_flag = lgate_activated
		}
	}
	immediate = {
		every_megastructure = {
			limit = {
				is_megastructure_type = lgate_base
				NOT = { has_megastructure_flag = lgate_activated }
			}
			activate_gateway = this
			set_megastructure_flag = lgate_activated
		}
	}
}

country_event = {
	# 中期开门
	id = rg.18
	title = rg.18.title
	desc = rg.18.desc
	is_triggered_only = yes
	fire_only_once = yes
	picture = GFX_evt_drifting_gateway
	trigger = {
		mid_game_years_passed >= 0
		has_country_flag = origin_rg_gray
		OR = {
			any_system_megastructure = {
				is_megastructure_type = lgate_base
				NOT = { has_megastructure_flag = lgate_activated }
			}
			NOT = { has_special_project = RG_LCLUSTER_PROJECT }
			has_special_project = LCLUSTER_PROJECT
		}
	}
	immediate = {
		every_system_within_border = {
			limit = {
				OR = {
					has_star_flag = lcluster_lgate
					has_star_flag = lgate_originating_system
				}
				any_system_megastructure = { 
					is_megastructure_type = l_gate_base
				}
			}
			save_event_target_as = candidate_gateway
		}

		abort_special_project = {
			type = LCLUSTER_PROJECT
		}

		enable_special_project = {
			name = RG_LCLUSTER_PROJECT
			location = event_target:candidate_gateway
		}

	}
}

event = {
	id = rg.19
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_ai = no
		NOT = { has_global_flag = has_rg_mod }
	}

	immediate = {
		set_global_flag = has_rg_mod
	}

}

country_event = {
	# 年检模拟龙年龄
	id = rg.20
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		any_owned_leader = {
			has_leader_flag = rg_fake_dragon
		}
	}
	immediate = {
		change_variable = {
			which = rg_fake_dragon_timedlife_counter
			value = 12
		}
		#等级导入，把存储的领袖等级赋予到领袖身上
		random_owned_leader = {
			limit = { has_leader_flag = rg_fake_dragon }
			set_age = owner.rg_fake_dragon_timedlife_counter
		}
		event_target:rg_fake_dragon_admiral = {
			change_leader_portrait = wg_dragon
			set_age = owner.rg_fake_dragon_timedlife_counter
		}
	}
}

# 拆毁工厂小灰通讯
country_event = {
	id = rg.200
	title = "rg.200.name"

	trigger = {
		NOT = {
			any_playable_country = {
				has_country_flag = gray_owner
			}
		}
	}

	desc = {
		trigger = {
			owner = { is_synthetic_empire = no }
		}
		text = "rg.200.a.desc"
	}
	desc = {
		trigger = { 
			owner = { is_synthetic_empire = yes } 
		}
		text = "rg.200.b.desc"
	}
	picture = GFX_evt_ship_in_orbit_2
	show_sound = event_radio_chatter

	is_triggered_only = yes

	#immediate = {
	#	from = { save_event_target_as = gray_homeworld }
	#}

	option = {
		name = rg.200.a
		hidden_effect = {
				create_fleet = {
					effect = {
						set_owner = event_target:graygoo_country
						create_ship = {
							name = random
							design = "NAME_Gray_Warship"
							graphical_culture = "pirate_01"
						}
						set_location = {
							target = event_target:main_star
							distance = 55
							angle = 270
						}
						save_event_target_as = aggressive_gray
					}
				}
		}
	}
	option = {
		name = rg.200.b
		hidden_effect = {
			owner = {
				country_event = { id = rg.400 }
			}
		}
	}
}

# L星龙暴毙小灰通讯
country_event = {
	id = rg.201
	title = "rg.201.name"

	trigger = {
		NOT = {
			any_playable_country = {
				has_country_flag = gray_owner
			}
		}
	}

	desc = {
		text = "rg.201.desc"
	}
	picture = GFX_evt_ship_in_orbit_2
	show_sound = event_radio_chatter

	is_triggered_only = yes

	#immediate = {
	#	from = { save_event_target_as = gray_homeworld }
	#}

	option = {
		name = rg.201.a
		hidden_effect = {
				create_fleet = {
					effect = {
						set_owner = event_target:graygoo_country
						create_ship = {
							name = random
							design = "NAME_Gray_Warship"
							graphical_culture = "pirate_01"
						}
						set_location = {
							target = event_target:main_star
							distance = 55
							angle = 270
						}
						save_event_target_as = aggressive_gray
					}
				}
		}
	}
	option = {
		name = rg.201.b
		hidden_effect = {
			owner = {
				country_event = { id = rg.402 }
			}
		}
	}
}
	
# 灰色风暴线小灰通讯
country_event = {
	id = rg.400
	title = "TRANSMISSION"

	trigger = {
		NOT = {
			any_playable_country = {
				has_country_flag = gray_owner
			}
		}
	}

	desc = {
		trigger = { NOT = { has_authority = auth_machine_intelligence } }
		text = "rg.400.a.desc"
	}
	desc = {
		trigger = { has_authority = auth_machine_intelligence }
		text = "rg.400.b.desc"
	}

	diplomatic = yes

	picture_event_data = {
		portrait = root.species
		room = "ethic_spaceship_room"
	}

	is_triggered_only = yes

	option = {
		name = rg.400.a
		trigger = {
			NOR = {
				has_authority = auth_machine_intelligence
				has_authority = auth_hive_mind
			}
		}
		hidden_effect = {
			country_event = { id = graygoo.406 }
		}
	}
	option = {
		name = rg.400.b
		trigger = {
			has_authority = auth_machine_intelligence
		}
		hidden_effect = {
			country_event = { id = graygoo.406 }
		}
	}
	option = {
		name = rg.400.c
		trigger = {
			has_authority = auth_hive_mind
		}
		hidden_effect = {
			country_event = { id = graygoo.406 }
		}
	}
	option = {
		name = rg.400.d
		hidden_effect = {
			country_event = { id = rg.401 }
		}
	}
}

country_event = {
	id = rg.401
	title = "TRANSMISSION"
	desc = "rg.401.desc"

	diplomatic = yes

	picture_event_data = {
		portrait = root.species
		room = "ethic_spaceship_room"
	}

	is_triggered_only = yes

	option = {
		name = rg.401.a
		response_text = rg.401.a.response
	}
	option = {
		name = rg.401.b
		hidden_effect = {
			create_fleet = {
				effect = {
					set_owner = event_target:graygoo_country
					create_ship = {
						name = random
						design = "NAME_Gray_Warship"
						graphical_culture = "pirate_01"
					}
					set_location = {
						target = event_target:main_star
						distance = 55
						angle = 270
					}
					save_event_target_as = aggressive_gray
				}
			}
		}
	}
}

# L星龙线小灰通讯
country_event = {
	id = rg.402
	title = "TRANSMISSION"
	desc = {
		text = "rg.402.a.desc"
	}

	diplomatic = yes

	picture_event_data = {
		portrait = root.species
		room = "ethic_spaceship_room"
	}

	is_triggered_only = yes

	option = {
		name = rg.402.a
		hidden_effect = {
			country_event = { id = rg.403 }
		}
	}
	option = {
		name = rg.402.b
		hidden_effect = {
			country_event = { id = rg.401 }
		}
	}
}

# L星龙线小灰通讯回答
country_event = {
	id = rg.403
	title = "TRANSMISSION"
	desc = "rg.403.desc"

	diplomatic = yes

	picture_event_data = {
		portrait = root.species
		room = "ethic_spaceship_room"
	}

	is_triggered_only = yes

	option = {
		name = rg.403.a
		response_text = rg.403.a.response
		default_hide_option = yes
		hidden_effect = {
			country_event = { id = graygoo.499 }
		}
	}
}

#快速防御
country_event = {
	id = rg.404
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		random_owned_ship = {
			limit = { is_ship_size = graygoo_factory }
			save_event_target_as = graygoo_factory
		}
		create_fleet = {
			name = "NAME_Tempest_Fleet"
			effect = {
				set_owner = root
				rg_emergency_fleet_defence = yes
				set_formation_scale = 2
				set_fleet_stance = aggressive
				set_aggro_range_measure_from = self
				set_aggro_range = 250
				set_location = {
					target = event_target:graygoo_factory
					distance = 10
					angle = random
				}
				fleet_event = { id = rg.406 days = 30 random = 5 }
			}
		}
		if = {
			limit = { num_fleets < 60 }
			create_fleet = {
				name = "NAME_Tempest_Fleet"
				effect = {
					set_owner = root
					rg_emergency_fleet_defence = yes
					set_formation_scale = 2
					set_fleet_stance = aggressive
					set_aggro_range_measure_from = self
					set_aggro_range = 250
					set_location = {
						target = event_target:graygoo_factory
						distance = 10
						angle = random
					}
					fleet_event = { id = rg.406 days = 30 random = 5 }
				}
			}
		}
		if = {
			limit = { num_fleets < 30 }
			create_fleet = {
				name = "NAME_Tempest_Fleet"
				effect = {
					set_owner = root
					rg_emergency_fleet_defence = yes
					set_formation_scale = 2
					set_fleet_stance = aggressive
					set_aggro_range_measure_from = self
					set_aggro_range = 250
					set_location = {
						target = event_target:graygoo_factory
						distance = 10
						angle = random
					}
					fleet_event = { id = rg.406 days = 30 random = 5 }
				}
			}
		}
	}
}

#舰队增援-触发
country_event = {
	id = rg.405
	hide_window = yes
	trigger = {
		is_country_type = gray_goo
	}
	mean_time_to_happen = {
		days = 180
	}

	immediate = {
		every_owned_fleet = {
			limit = { any_ship = { is_ship_size = graygoo_mothership } }
			fleet_event = { id = rg.406 days = 4 random = 3 }
		}
	}
}

#母舰增援-天灾
fleet_event = {
	id = rg.406
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		#_end game
		if = {
			limit = {
				end_game_years_passed >= -10
				num_ships < 20
			}
			random_list = {#_100%
				20 = {
					create_ship = {
						name = random
						design = "NAME_Nanite_Mothership"
						graphical_culture = "pirate_01"
						upgradable = no
					}
				}
				10 = {
					create_ship = {
						name = random
						design = "RG_aircruiser_Interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				10 = {
					create_ship = {
						name = random
						design = "RG_carrier_Interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				10 = {
					create_ship = {
						name = random
						design = "RG_battleship_Interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				10 = {
					create_ship = {
						name = random
						design = "RG_titan_interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				10 = {
					create_ship = {
						name = random
						design = "RG_torpedo_interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				10 = {
					create_ship = {
						name = random
						design = "RG_AA_interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				10 = {
					create_ship = { 
						name = random
						design = "RG_Arsenal_Interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				10 = {
					create_ship = {
						name = random
						design = "RG_torpedocruiser_interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
			}
		}
		#mid game
		else_if = {
			limit = {
				end_game_years_passed < -10
				mid_game_years_passed >= -10
				num_ships < 15
			}
			random_list = {#_85%
				10 = {
					create_ship = {
						name = random
						design = "RG_aircruiser_Interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				10 = {
					create_ship = {
						name = random
						design = "RG_carrier_Interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				10 = {
					create_ship = {
						name = random
						design = "RG_battleship_Interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				10 = {
					create_ship = {
						name = random
						design = "RG_titan_interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				10 = {
					create_ship = {
						name = random
						design = "RG_torpedo_interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				10 = {
					create_ship = {
						name = random
						design = "RG_AA_interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				10 = {
					create_ship = { 
						name = random
						design = "RG_Arsenal_Interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				10 = {
					create_ship = {
						name = random
						design = "RG_torpedocruiser_interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				5 = {
					create_ship = {
						name = random
						design = "NAME_Nanite_Mothership"
						graphical_culture = "pirate_01"
						upgradable = no
					}
				}
			}
		}
		#before mid game
		else_if = {
			limit = {
				mid_game_years_passed < -10
				num_ships < 10
			}
			random_list = {#45%
				55 = {}
				5 = {
					create_ship = {
						name = random
						design = "NAME_Nanite_Mothership"
						graphical_culture = "pirate_01"
						upgradable = no
					}
				}
				5 = {
					create_ship = {
						name = random
						design = "RG_aircruiser_Interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				5 = {
					create_ship = {
						name = random
						design = "RG_carrier_Interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				5 = {
					create_ship = {
						name = random
						design = "RG_battleship_Interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				5 = {
					create_ship = {
						name = random
						design = "RG_titan_interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				5 = {
					create_ship = {
						name = random
						design = "RG_torpedo_interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				5 = {
					create_ship = {
						name = random
						design = "RG_AA_interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				5 = {
					create_ship = { 
						name = random
						design = "RG_Arsenal_Interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
				5 = {
					create_ship = {
						name = random
						design = "RG_torpedocruiser_interdictor"
						graphical_culture = "pirate_01"
						upgradable = yes
					}
				}
			}
		}
	}
}

#中期增援
country_event = {
	id = rg.407
	hide_window = yes

	trigger = {
		is_country = event_target:global_event_country
		end_game_years_passed < -10			#后期
		mid_game_years_passed >= -10		#中期
		has_global_flag = active_gray_goo	#灰蛊天灾开始，且没有被清除
		any_system = {
			has_star_flag = graygoo_factory_system
			any_fleet_in_system = { is_ship_size = graygoo_factory }
		}
	}
	mean_time_to_happen = {
		months = 20
	}

	immediate = {#设定灰蛊国家target
		random_country = {
			limit = { is_country_type = gray_goo }
			save_event_target_as = graygoo_country
		}
		#外部威胁进入，立刻创建3支增援舰队
		if = {
			limit = {
				any_system = {
					has_star_flag = lcluster
					any_fleet_in_system = {
						owner = {
							NOT = { is_country = event_target:graygoo_country }	#非灰蛊天灾
						}
					}
				}
			}
			random_country = {
				limit = { is_country = event_target:graygoo_country }
				country_event = { id = rg.405 days = 10 random = 5 }
			}
		}
		else_if = {
			limit = { event_target:graygoo_country = { num_fleets < 30 } }
			every_system = {
				limit = {
					NOR = {
						has_star_flag = lcluster_lgate
						has_star_flag = lgate_originating_system
					}
					any_system_megastructure = { 
						is_megastructure_type = l_gate_base
					}
				}
				random_system_megastructure = {#每个L门产生一支灰蛊舰队
					limit = {
						is_megastructure_type = l_gate_base
					}
					create_ambient_object = {
						type = "horror_spawn_object"
						location = THIS
						use_3d_location = yes
						duration = 10
					}
					create_fleet = {#中期1支舰队
						name = "NAME_Tempest_Fleet"
						effect = {
							set_owner = event_target:graygoo_country
							rg_create_graygoo_fleet_random = yes
							set_formation_scale = 2
							set_fleet_stance = aggressive
							set_aggro_range_measure_from = self
							set_aggro_range = 250
							set_location = {
								target = prev
								distance = 0
								angle = 0
							}
							fleet_event = { id = rg.406 days = 30 random = 5 }	#_
						}
					}
				}
			}
		}
	}
}
#末期增援
country_event = {
	id = rg.408
	hide_window = yes

	trigger = {
		is_country = event_target:global_event_country
		end_game_years_passed >= -10		#后期增援
		has_global_flag = active_gray_goo	#灰蛊天灾开始，且没有被清除
		any_system = {
			has_star_flag = graygoo_factory_system
			any_fleet_in_system = { is_ship_size = graygoo_factory }
		}
	}
	mean_time_to_happen = {
		months = 20
	}

	immediate = {
		random_country = {#只有一个灰蛊
			limit = { is_country_type = gray_goo }
			save_event_target_as = graygoo_country
		}
		#外部威胁进入，立刻创建3支增援舰队
		if = {
			limit = {
				any_system = {
					has_star_flag = lcluster
					any_fleet_in_system = {
						owner = {
							NOT = { is_country = event_target:graygoo_country }	#非灰蛊天灾
						}
					}
				}
			}
			random_country = {
				limit = { is_country = event_target:graygoo_country }
				country_event = { id = rg.405 days = 10 random = 5 }
			}
		}
		if = {
			limit = { event_target:graygoo_country = { num_fleets < 60 } }
			every_system = {
				limit = {
					NOR = {
						has_star_flag = lcluster_lgate
						has_star_flag = lgate_originating_system
					}
					any_system_megastructure = { 
						is_megastructure_type = l_gate_base
					}
				}
				random_system_megastructure = {
					limit = {
						is_megastructure_type = l_gate_base
					}
					create_ambient_object = {
						type = "horror_spawn_object"
						location = THIS
						use_3d_location = yes
						duration = 10
					}
					while = {#后期2支舰队
						count = 2
						create_fleet = {
							name = "NAME_Tempest_Fleet"
							effect = {
								set_owner = event_target:graygoo_country
								rg_create_graygoo_fleet_random = yes
								set_formation_scale = 2
								set_fleet_stance = aggressive
								set_aggro_range_measure_from = self
								set_aggro_range = 250
								set_location = {
									target = prev
									distance = 0
									angle = 0
								}
								fleet_event = { id = rg.406 days = 30 random = 5 }	#_
							}
						}
					}
				}
			}
		}
	}
}


