#普通的母舰
rg_warship_init_mod1 = {
	create_fleet = {
		name = "NAME_Gray"
		settings = {
			can_upgrade = no
			can_disband = no
			can_change_composition = no
			can_change_leader = yes
			uses_naval_capacity = no
			spawn_debris = no
		}
		effect = {
			set_owner = prev
			create_ship = {
				name = "NAME_Gray"
				# design = "NAME_Gray_Warship_rg"
				random_existing_design = RG_graygoo_mothership
				prefix = no
				upgradable = yes
				effect = {
					set_fleet_flag = gray_fleet_ship
					save_global_event_target_as = gray_warship_ship
				}
			}
			set_fleet_stance = aggressive
			set_location = {
				target = event_target:global_gray_location
				distance = 0
				angle = random
			}
			set_fleet_flag = gray_fleet
			save_global_event_target_as = gray_warship
			assign_leader = event_target:gray_leader_admiral
			if = {
				limit = {
					has_global_flag = kdc_event_mod_active
				}
				add_modifier = {
					modifier = remove_fleet_maintenance
				}
			}
		}
	}
}
#纳米旗舰
rg_warship_init_mod2 = {
	create_fleet = {
		name = "NAME_Gray"
		settings = {
			can_upgrade = no
			can_disband = no
			can_change_composition = no
			can_change_leader = yes
			uses_naval_capacity = no
			spawn_debris = no
		}
		effect = {
			set_owner = prev
			create_ship = {
				name = "NAME_Gray"
				random_existing_design = RG_graygoo_capitalship
				prefix = no
				upgradable = yes
				effect = {
					set_fleet_flag = gray_fleet_ship
					save_global_event_target_as = gray_warship_ship
				}
			}
			set_fleet_stance = aggressive
			set_location = {
				target = event_target:global_gray_location
				distance = 0
				angle = random
			}
			set_fleet_flag = gray_fleet
			save_global_event_target_as = gray_warship
			assign_leader = event_target:gray_leader_admiral
			if = {
				limit = {
					has_global_flag = kdc_event_mod_active
				}
				add_modifier = {
					modifier = remove_fleet_maintenance
				}
			}
		}
	}
}
#纳米主宰
rg_warship_init_mod3 = {
	create_fleet = {
		name = "NAME_Gray"
		settings = {
			can_upgrade = no
			can_disband = no
			can_change_composition = no
			can_change_leader = yes
			uses_naval_capacity = no
			spawn_debris = no
		}
		effect = {
			set_owner = prev
			create_ship = {
				name = "NAME_Gray"
				# design = "NAME_gray_juggernautship"
				random_existing_design = RG_gray_juggernaut
				prefix = no
				upgradable = yes
				effect = {
					set_fleet_flag = gray_fleet_ship
					save_global_event_target_as = gray_warship_ship
				}
			}
			set_fleet_stance = aggressive
			set_location = {
				target = event_target:global_gray_location
				distance = 0
				angle = random
			}
			set_fleet_flag = gray_fleet
			save_global_event_target_as = gray_warship
			if = {
				limit = {
					has_global_flag = kdc_event_mod_active
				}
				add_modifier = {
					modifier = remove_fleet_maintenance
				}
			}
		}
	}
}
#略有磨损的母舰
rg_warship_init_mod0 = {
	create_fleet = {
		name = "NAME_Gray"
		settings = {
			can_upgrade = no
			can_disband = no
			can_change_composition = no
			can_change_leader = yes
			uses_naval_capacity = no
			spawn_debris = no
		}
		effect = {
			set_owner = prev
			create_ship = {
				name = "NAME_Gray"
				design = "NAME_Gray_Warship_base"
				prefix = no
				upgradable = yes
				effect = {
					set_fleet_flag = gray_fleet_ship
					save_global_event_target_as = gray_warship_ship
				}
			}
			set_fleet_stance = aggressive
			set_location = {
				target = event_target:global_gray_location
				distance = 0
				angle = random
			}
			set_fleet_flag = gray_fleet
			save_global_event_target_as = gray_warship
			assign_leader = event_target:gray_leader_admiral
			if = {
				limit = {
					has_global_flag = kdc_event_mod_active
				}
				add_modifier = {
					modifier = remove_fleet_maintenance
				}
			}
		}
	}
}

rg_create_gray_maid_species_effect = {
	create_species = {
		name = 纳米构造体
		class = RG_MACHINE
		portrait = "rg_machine_maid"
		traits = {
			trait = trait_machine_unit
			trait = trait_robot_domestic_protocols
			trait = rg_machine_maid_trait
			trait = trait_auto_mod_robotic
			trait = trait_robot_streamlined_protocols
			trait = trait_robot_luxurious
			trait = ramdom_trait
		}
		extra_trait_points = 3
		allow_negative_traits = no
		namelist = MACHINE3
		effect = {
			save_event_target_as = rg_gray_maid_species
		}
	}
}

rg_juggernaut_habitat_init = {
	event_target:global_gray_location = {
		solar_system = {
			spawn_planet = {
				class = pc_rg_grayhabitat
				spawn_beyond_gravity_well = yes
				orbit_location = yes
				orbit_angle_offset = 45
				orbit_distance_offset = 9.899
				size = 20
				has_ring = no
		
				init_effect = {
					set_surveyed = {
						surveyed = yes
						surveyor = FROM
					}
					set_all_comms_surveyed = yes
					clear_blockers = yes
	
					set_owner = root
					set_controller = root
					create_colony = {
						owner = root
						species = rg_gray_maid_species
						ethos = owner
					}
					set_name = "NAME_rg_gray_habitat_base"
					assign_leader = event_target:gray_governor
	
					add_building = building_ancient_control_center
					add_building = building_nourishment_center
					add_building = building_ancient_palace
					add_building = building_affluence_center
					add_building = building_dimensional_fabricator

					if = {
						limit = {
							NOT = {
								exists = event_target:rg_gray_maid_species
							}
						}
						rg_create_fallen_empire_species_effect = yes
					}
		
					while = {
						count = 5
						create_pop = {
							species = rg_gray_maid_species
						}
					}
		
					set_planet_flag = megastructure
					set_planet_flag = habitat
					set_planet_flag = advanced_habitat
					set_planet_flag = advanced_habitat_2
					set_planet_flag = rg_gray_habitat
					save_global_event_target_as = rg_gray_habitat_target
				}
			}
		}
	}
}
