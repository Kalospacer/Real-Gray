# Home System - Machine

rg_fallen_machine = {
	usage = fallen_empire_init
	name = 芬里尔III
	class = "rl_standard_stars"

	flags = {
		lcluster
		lcluster4
		ring_world_built
	}

	planet = {
		class = star
		orbit_distance = 0
		orbit_angle = 0
	}

	change_orbit = 45

	planet = {
		class = "pc_ringworld_tech"
		name = 外环
		orbit_angle = -30
		orbit_distance = 0
	}

	planet = {
		class = "pc_ringworld_seam"
		name = 泡芙碗
		orbit_angle = 30
		orbit_distance = 0
	}

	planet = {
		class = "pc_ringworld_habitable"
		name = 菠萝包工厂
		orbit_angle = 30
		orbit_distance = 0
		deposit_blockers = none
		modifiers = none

		init_effect = {

			create_cluster = {
				id = fe_mach_cluster
				radius = 80
				center = this.solar_system
			}

			create_species = {
				name = 纳米构造体
				class = RG_MACHINE
				portrait = "rg_machine_maid"
				traits = {
					trait = trait_machine_unit
					trait = rg_machine_maid_trait
					trait = trait_robot_mass_produced
					trait = ramdom_trait
				}
				extra_trait_points = 3
				allow_negative_traits = no
				namelist = MACHINE3
				effect = {
					save_event_target_as = rg_fallen_maid_species
				}
			}
			create_country = {
				name = 德萨努-纳迪沙协议
				type = fallen_empire
				flag = {
					icon = {
						category = "special"
						file = "gray_goo.dds"
					}
					background = {
						category = "backgrounds"
						file = "sinus.dds"
					}
					colors = {
						"grey"
						"dark_grey"
						"null"
						"null"
					}
				}
				ignore_initial_colony_error = yes
				authority = auth_machine_intelligence
				civics = {
					civic = civic_machine_remnants
					civic = civic_custodian_directives
				}
				species = last_created_species
				ethos = {
					ethic = ethic_gestalt_consciousness
				}
				origin = "origin_fallen_empire"
				effect = {
					set_built_species = last_created_species
					save_global_event_target_as = rg_scion_fe
					set_country_flag = rg_fallen_empire_machine
					add_resource = {
						minerals = 10000
						energy = 10000
						food = 1000
						influence = 500
					}
					if = {
						limit = { host_has_dlc = "Apocalypse" }
						give_technology = {
							tech = tech_colossus
							message = no
						}
					}
					# must initialize global designs here
					add_global_ship_design = "NAME_Gray_Omega"
					add_global_ship_design = "NAME_Gray_Alpha"
					add_global_ship_design = "NAME_Gray_Beta"
					add_global_ship_design = "NAME_Gray_Gamma"
					add_global_ship_design = "NAME_Gray_Theta"
					add_global_ship_design = "NAME_Gray_Tau"
					add_global_ship_design = "NAME_Gray_Sigma"
					add_global_ship_design = "NAME_Gray_FE_Starbase"
					if = {
						limit = {
							NOT = {
								exist = event_target:rg_gray_country_leader
							}
						}
						rg_gray_country_leader_init = yes
						set_leader = last_created_leader
					}
					else = {
						set_leader = last_created_leader
					}
					ruler = {
						add_skill = 9
					}
				}
			}
			set_planet_flag = fallen_empire_world
			prevent_anomaly = yes
			set_owner = event_target:rg_scion_fe
			set_controller = event_target:rg_scion_fe
			set_capital = yes

			add_building = building_ancient_control_center
			add_building = building_nourishment_center
			add_building = building_nourishment_center
			add_building = building_nourishment_center
			add_building = building_nourishment_center
			add_building = building_ancient_palace
			add_building = building_affluence_center
			add_building = building_affluence_center
			add_building = building_affluence_center
			add_building = building_affluence_center
			add_building = building_dimensional_fabricator
			add_building = building_dimensional_fabricator

			while = {
				count = 5
				add_district = district_rw_science
			}
			while = {
				count = 5
				add_district = district_rw_nexus
			}
			while = {
				count = 105
				create_pop = {
					species = owner_main_species
				}
			}

			while = {
				count = 94
				create_pop = {
					species = event_target:rg_scion_slave.species
				}
			}

			rg_create_fallen_empire_starting_navy = yes

			while = {
				count = 40
				create_army = {
					name = random
					owner = event_target:rg_scion_fe
					type = "gray_army"
				}
			}
		}
	}

	init_effect = {
		spawn_megastructure = {
			type = "ring_world_ruined"
			orbit_angle = -90
			orbit_distance = 45
		}
		# rg_create_fe_citadel = yes
	}

	planet = {
		class = "pc_ringworld_tech"
		name = 中环
		orbit_angle = 30
		orbit_distance = 0
	}

	planet = {
		class = "pc_ringworld_seam"
		name = 烤面包机
		orbit_angle = 30
		orbit_distance = 0
	}

	planet = {
		class = "pc_ringworld_habitable"
		name = 可颂工厂
		orbit_angle = 30
		orbit_distance = 0
		deposit_blockers = none
		modifiers = none

		init_effect = {

			set_planet_flag = fallen_empire_world
			prevent_anomaly = yes
			set_owner = event_target:rg_scion_fe

			add_building = building_ancient_control_center
			add_building = building_dimensional_fabricator
			add_building = building_dimensional_fabricator
			add_building = building_dimensional_fabricator
			add_building = building_dimensional_fabricator
			add_building = building_dimensional_fabricator
			add_building = building_nano_forge
			add_building = building_nano_forge
			add_building = building_nano_forge
			add_building = building_nano_forge
			add_building = building_nano_forge

			while = {
				count = 5
				add_district = district_rw_nexus
			}
			while = {
				count = 50
				create_pop = {
					species = owner_main_species
				}
			}
			while = {
				count = 20
				create_pop = {
					species = event_target:rg_scion_slave.species
				}
			}
			while = {
				count = 20
				create_army = {
					name = random
					owner = event_target:rg_scion_fe
					type = "gray_army"
				}
			}
		}
	}

	planet = {
		class = "pc_ringworld_tech"
		name = 内环
		orbit_angle = 30
		orbit_distance = 0
	}

	planet = {
		class = "pc_ringworld_seam"
		name = 奶油核心
		orbit_angle = 30
		orbit_distance = 0
	}

	planet = {
		class = "pc_ringworld_habitable"
		name = 糖霜工厂
		orbit_angle = 30
		orbit_distance = 0
		deposit_blockers = none
		modifiers = none

		init_effect = {
			set_planet_flag = fallen_empire_world
			prevent_anomaly = yes
			set_owner = event_target:rg_scion_fe

			add_building = building_ancient_control_center
			add_building = building_class_4_singularity
			add_building = building_class_4_singularity
			add_building = building_class_4_singularity
			add_building = building_class_4_singularity
			add_building = building_nano_forge
			add_building = building_nano_forge
			add_building = building_nano_forge
			add_building = building_nano_forge
			add_building = building_nano_forge
			add_building = building_nano_forge

			while = {
				count = 5
				add_district = district_rw_generator
			}
			while = {
				count = 22
				create_pop = {
					species = owner_main_species
				}
			}
			while = {
				count = 10
				create_pop = {
					species = event_target:rg_scion_slave.species
				}
			}
			while = {
				count = 10
				create_army = {
					name = random
					owner = event_target:rg_scion_fe
					type = "gray_army"
				}
			}
		}
	}

	# spawn_megastructure = {
	# 	type = lgate_base
	# 	orbit_angle = 225
	# 	orbit_distance = 30
	# }
}

